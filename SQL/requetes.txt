//Faire la moyenne des points marqués par rencontre jusque à une date donnée
//ici date = '2020-11-17'
SELECT AVG(points)
FROM(
Select SUM(RENCONTRE.POINTE1+RENCONTRE.POINTE2) AS points,RENCONTRE.NUMERO_RENCONTRE
FROM RENCONTRE
WHERE RENCONTRE.DATE_RENCONTRE <= '2020-11-17'
GROUP BY RENCONTRE.NUMERO_RENCONTRE
ORDER BY 2 ) AS Moyenne;



//Faire la moyenne des points marqués par rencontre de la saison
SELECT AVG(points)
FROM(
Select SUM(RENCONTRE.POINTE1+RENCONTRE.POINTE2) AS points,RENCONTRE.NUMERO_RENCONTRE
FROM RENCONTRE
WHERE YEAR(RENCONTRE.DATE_RENCONTRE) =(Select YEAR(MAX(RENCONTRE.DATE_RENCONTRE))
                                       From RENCONTRE)
GROUP BY RENCONTRE.NUMERO_RENCONTRE
ORDER BY 2 ) AS Moyenne;



//classement des meilleurs joueurs d’une journée pour une catégorie
//ici date = '2020-11-17' et catégorie = 'Benjamin'
SELECT JOUEUR.NOM_JOUEUR, SUM(POINT_JOUEUR.POINTS_MARQUES)
FROM ((((JOUEUR LEFT OUTER JOIN POINT_JOUEUR
ON JOUEUR.NUMERO_LICENCE=POINT_JOUEUR.NUMERO_LICENCE) 
INNER JOIN RENCONTRE
ON POINT_JOUEUR.NUMERO_RENCONTRE=RENCONTRE.NUMERO_RENCONTRE) 
INNER JOIN PARTIE
ON RENCONTRE.NUMERO_RENCONTRE= PARTIE.NUMERO_RENCONTRE)
INNER JOIN EQUIPE
ON PARTIE.NUMERO_EQUIPE1=EQUIPE.NUMERO_EQUIPE)
INNER JOIN CATEGORIE
ON EQUIPE.NUMERO_CATEGORIE=CATEGORIE.NUMERO_CATEGORIE
WHERE RENCONTRE.DATE_RENCONTRE= '2020-11-17'
AND CATEGORIE.NOM_CATEGORIE='Benjamin'
GROUP BY JOUEUR.NOM_JOUEUR
ORDER BY 2 DESC;



//classement des meilleurs joueurs de la saison
SELECT JOUEUR.PRENOM_JOUEUR,JOUEUR.NOM_JOUEUR, SUM(POINT_JOUEUR.POINTS_MARQUES)
FROM ((((JOUEUR LEFT OUTER JOIN POINT_JOUEUR
ON JOUEUR.NUMERO_LICENCE=POINT_JOUEUR.NUMERO_LICENCE) 
INNER JOIN RENCONTRE
ON POINT_JOUEUR.NUMERO_RENCONTRE=RENCONTRE.NUMERO_RENCONTRE) 
INNER JOIN PARTIE
ON RENCONTRE.NUMERO_RENCONTRE= PARTIE.NUMERO_RENCONTRE)
INNER JOIN EQUIPE
ON PARTIE.NUMERO_EQUIPE1=EQUIPE.NUMERO_EQUIPE)
INNER JOIN CATEGORIE
ON EQUIPE.NUMERO_CATEGORIE=CATEGORIE.NUMERO_CATEGORIE
WHERE YEAR(RENCONTRE.DATE_RENCONTRE)=(Select YEAR(MAX(RENCONTRE.DATE_RENCONTRE))
                                       From RENCONTRE)
AND CATEGORIE.NOM_CATEGORIE='Benjamin'
GROUP BY JOUEUR.NOM_JOUEUR,JOUEUR.PRENOM_JOUEUR
ORDER BY 3 DESC;



//Classement des Equipes
SELECT EQUIPE.NOM_EQUIPE, SUM(PE1) 
FROM(
SELECT EQUIPE.NOM_EQUIPE AS Nom, SUM(RENCONTRE.POINTE1) AS PE1
FROM (EQUIPE LEFT OUTER JOIN PARTIE
ON EQUIPE.NUMERO_EQUIPE = PARTIE.NUMERO_EQUIPE1)
INNER JOIN RENCONTRE 
ON PARTIE.NUMERO_RENCONTRE=RENCONTRE.NUMERO_RENCONTRE
WHERE RENCONTRE.DATE_RENCONTRE <= (SELECT MAX(RENCONTRE.DATE_RENCONTRE)
                                  FROM RENCONTRE)
GROUP BY EQUIPE.NOM_EQUIPE
UNION
SELECT EQUIPE.NOM_EQUIPE, SUM(RENCONTRE.POINTE2)
FROM (EQUIPE LEFT OUTER JOIN PARTIE
ON EQUIPE.NUMERO_EQUIPE = PARTIE.NUMERO_EQUIPE2)
INNER JOIN RENCONTRE 
ON PARTIE.NUMERO_RENCONTRE=RENCONTRE.NUMERO_RENCONTRE
WHERE RENCONTRE.DATE_RENCONTRE <= (SELECT MAX(RENCONTRE.DATE_RENCONTRE)
                                  FROM RENCONTRE)
GROUP BY EQUIPE.NOM_EQUIPE) AS TOTAL ,EQUIPE
WHERE EQUIPE.NOM_EQUIPE=Nom
GROUP BY EQUIPE.NOM_EQUIPE
ORDER BY 2 DESC
